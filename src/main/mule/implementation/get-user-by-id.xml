<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:db="http://www.mulesoft.org/schema/mule/db"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
<!-- [STUDIO:"get-user-by-id-api-SubFlow"]	<sub-flow name="get-user-by-id-api-SubFlow" doc:id="51e756ad-93ee-4105-b241-a98e339c3090" >
		<logger level="INFO" doc:name="start Log payload HTTP-get:\users\{id}:sapi-database " doc:id="e10b619f-d811-409e-ab22-d36123b63f55" message="start Log payload HTTP-get:\users\{id}:sapi-database  #[payload&#93;" />
		<set-variable value="#[attributes.uriParams.'Id'&#93;" doc:name="id" doc:id="6df2b111-a8b4-41bf-968b-13b90fe5e43e" variableName="id"/>
		<set-variable doc:name="setSelectSqlQuerry" doc:id="7dad1c6f-95a1-446b-af13-04a082efb086" variableName="setSelectSqlQuerry" value='#["&#10;SELECT *&#10;FROM user&#10;WHERE id = :id;&#10;"&#93;'/>
		<db:select doc:name="Select users by id" doc:id="05e771ec-9946-4090-8388-16d2b45708b0" config-ref="Database_Config_User">
			<db:sql><![CDATA[#[vars.setSelectSqlQuerry&#93;&#93;&#93;></db:sql>
			<db:input-parameters><![CDATA[#[{
id : attributes.uriParams.'Id'
}&#93;&#93;&#93;></db:input-parameters>
		</db:select>
		<ee:transform doc:name="fail Function" doc:id="992577c1-b80f-4002-8ece-a4b8ea0fd97a">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0 
output application/json
import * from dw::Runtime
fun userNotFound(message) = if(payload == [&#93; )
fail("User Not Found")
else
payload
&#45;&#45;-
try(() ->userNotFound(payload))
&#93;&#93;></ee:set-payload>
				</ee:message>
			</ee:transform>
		<choice doc:name="Choice" doc:id="0929ca36-863c-4c9c-815e-7a12538a341c" >
			<when expression="#[payload.success == true&#93;">
				<ee:transform doc:name="Set output payload" doc:id="447c140e-be2b-4f04-b191-adf2696be4c5">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
&#45;&#45;-
payload.result map ( payload , indexOfPayload ) -> {
	id:payload.id,
	email:payload.email,
	firstName:payload.firstName,
	lastName:payload.lastName,
	manager_id:payload.manager_id,
	street:payload.street,
	city: payload.city,
	dob:payload.dob,
	updated_at:payload.updated_at,
	initials:payload.initials	
}&#93;&#93;></ee:set-payload>
			</ee:message>
		</ee:transform>
			</when>
			<otherwise >
				<raise-error doc:name="Raise error" doc:id="350c35d2-6c79-4c62-9703-651dc08793b1" type="CUSTOM:USER_NOT_FOUND"/>
			</otherwise>
		</choice>
		<logger level="INFO" doc:name="end Log payload HTTP-get:\users\{id}:sapi-database" doc:id="062efac7-70af-4970-bf69-0f3235d7c90c" message="end Log payload HTTP-get:\users\{id}:sapi-database #[payload&#93;" />
	</sub-flow> [STUDIO] -->

</mule>
